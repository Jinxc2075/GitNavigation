--GameStateTBox

require("class")
require("utils/XLuaUtils")
local BaseState = require("state/BaseState")
local coroutine_cs = require("coroutine_cs")
local EventDispatcher = require("event/EventDispatcher")

local csEventControllerInst = CS.EventController.inst
local csGameEventType = CS.GameEventType
local csSceneManager = CS.UnityEngine.SceneManagement.SceneManager
local csGameTimer = CS.GameTimer
local csAudioManager = CS.AudioManager
local csFGUI = CS.FGUI
local csManagerBinder = CS.ManagerBinder

local csAccountDataProxy = CS.AccountDataProxy

local GameStateTBox = class(BaseState)

local startLoadScene = false

function GameStateTBox:onEnter(transition)
	print("enter GameStateTBox")
	CS.ManagerBinder.inst.mGameState = CS.kGameState.TBox

	startLoadScene = false

	GameStateTBox:loadTBoxScene()
end

function GameStateTBox:loadTBoxScene()
	print("GameStateTBox:GameStateTBox")
	coroutine_cs.start(
		function()
			if (startLoadScene == false) then
				startLoadScene = true

				local aop = csManagerBinder.inst.mSceneMgr:loadScene("TreasureBoxScene")
				coroutine.yield(aop)
				coroutine_cs.wait(0.6)

				csAudioManager.inst:PlayMusic(2)
				csFGUI.inst:StartExcessAnimation(false, false)

				csEventControllerInst:TriggerEvent(csGameEventType.TreasureBoxEvent.SETTBOXCAMERA)
				csEventControllerInst:TriggerEvent(csGameEventType.TreasureBoxEvent.OPENTBOXUINOTPARA)
				
				CS.ManagerBinder.inst.stateIsChanging = false
			end
		end
	)
end



function GameStateTBox:onExit()
	print("exit GameStateTBox")
	startLoadScene = false


	csSceneManager.UnloadSceneAsync("TreasureBoxScene")
	csEventControllerInst:TriggerEvent(csGameEventType.TreasureBoxEvent.SETTBOXCAMERAREVERT)
	csEventControllerInst:TriggerEvent(csGameEventType.TreasureBoxEvent.OPENBOX_HIDEUI)
end

return GameStateTBox