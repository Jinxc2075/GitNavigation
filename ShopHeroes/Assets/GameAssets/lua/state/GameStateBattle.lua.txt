--GameStateBattle
require("class")
local BaseState = require("state/BaseState")

local csEventControllerInst = CS.EventController.inst
local csGameEventType = CS.GameEventType
local csFGUI = CS.FGUI
local EventDispatcherInis = require("event/EventDispatcher")

local GameStateBattle = class(BaseState)

local startLoadScene = false

function GameStateBattle:onEnter(transition)
	CS.ManagerBinder.inst.mGameState = CS.kGameState.Battle
	csEventControllerInst:AddListener(csGameEventType.CombatEvent.COMBAT_SCENE_LOADED, GameStateBattle.onSceneLoadEnd)
	csEventControllerInst:TriggerEvent(csGameEventType.CombatEvent.COMBAT_INITSCENE)
	EventDispatcherInis:dispatchEvent(GameEvent.MsgTipEvent.PauseRaceLampTip)
	CS.ManagerBinder.inst.stateIsChanging = false
end

function GameStateBattle:onSceneLoadEnd()
	csFGUI.inst:StartExcessAnimation(false, false, nil)
end

function GameStateBattle:onExit()
	csEventControllerInst:RemoveListener(
		csGameEventType.CombatEvent.COMBAT_SCENE_LOADED,
		GameStateBattle.onSceneLoadEnd
	)
	csEventControllerInst:TriggerEvent(csGameEventType.CombatEvent.COMBAT_EXIT)
	EventDispatcherInis:dispatchEvent(GameEvent.MsgTipEvent.RePlayRaceLampTip)
end

return GameStateBattle
