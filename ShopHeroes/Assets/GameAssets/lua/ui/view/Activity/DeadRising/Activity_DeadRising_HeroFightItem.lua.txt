
-- Activity_DeadRising_HeroFightItem

require("class")
require("utils/XLuaUtils")
local EventDispatcher = require("event/EventDispatcher")

local CS_type_LuaBehaviour = typeof(CS.LuaBehaviour)
local CS_type_GUIIcon = typeof(CS.GUIIcon)

local CS_RoleDataProxyInst = CS.RoleDataProxy.inst
local CS_CharacterManagerInst = CS.CharacterManager.inst
local CS_SpineUtils = CS.SpineUtils

local Vector3 = CS.UnityEngine.Vector3


local Activity_DeadRising_HeroFightItem = class()


function Activity_DeadRising_HeroFightItem:Init(obj,clickHandler)

	self.type = type
	self.gameObject = obj
	self.transform = obj.transform
	self.contentPane = obj:GetComponent(CS_type_LuaBehaviour)
	self.clickHandler = clickHandler
	self.heroUid = 0
	self.graphicDressUp = nil

	self.obj_have = self.contentPane:GetObjByName("obj_have")
	self.obj_none = self.contentPane:GetObjByName("obj_none")
	self.tf_headDress = self.contentPane:GetObjByName("tf_headDress"):GetComponent("RectTransform")
	self.tx_fight = self.contentPane:GetText("tx_fight")

	self.icon_bg = self.gameObject:GetComponent(CS_type_GUIIcon)
	self.button = self.gameObject:GetComponent("Button")

	self.button.onClick:AddListener(function ()
			self:onButtonClick()
		end)

end

function Activity_DeadRising_HeroFightItem:SetData(heroUid)
	
	self.heroUid = heroUid
	self.obj_have:SetActive(true)
	self.obj_none:SetActive(false)
	
	local roleHeroData = CS_RoleDataProxyInst:GetHeroDataByUid(self.heroUid)
	
	if roleHeroData ~= nil then
		
		if self.graphicDressUp == nil then
			
			local funcGeneric = xlua.get_generic_method(CS.CharacterManager, "GetCharacter")
			local func = funcGeneric(CS.GraphicDressUpSystem)

			func(CS_CharacterManagerInst,CS_CharacterManagerInst:GetPeopleShapeNudeSpinePath(CS.EGender.__CastFrom(roleHeroData.gender)),roleHeroData:GetHeadDressIds(),CS.EGender.__CastFrom(roleHeroData.gender),1.4,true,function (system)
					
					self.graphicDressUp = system
					system.transform:SetParent(self.tf_headDress);
					system.transform.localScale = Vector3.one;
					system.transform.localPosition = Vector3.zero;
					
				end)
			
		else
			CS_CharacterManagerInst:ReSetCharacter(self.graphicDressUp, CS_CharacterManagerInst:GetPeopleShapeNudeSpinePath(CS.EGender.__CastFrom(roleHeroData.gender)), roleHeroData.GetHeadDressIds(), CS.EGender.__CastFrom(roleHeroData.gender));
		end
		
		self.tx_fight.text = tostring(roleHeroData.fightingNum)
		
	end
	
	
end

function Activity_DeadRising_HeroFightItem:Clear()
	
	self.heroUid = 0
	
	self.obj_have:SetActive(false)
	self.obj_none:SetActive(true)
	--self.icon_bg:SetSprite("","")	
	
end


function Activity_DeadRising_HeroFightItem:onButtonClick()
	
	if self.clickHandler ~= nil then
		
		local uid = -1
		if self.data ~= nil then
			uid = self.data.uid
		end
		
		self.clickHandler(uid)
		
	end
	
end



return Activity_DeadRising_HeroFightItem
