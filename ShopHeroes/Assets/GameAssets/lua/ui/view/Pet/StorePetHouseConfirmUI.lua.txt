--StorePetHouseConfirmUI

require("const/Constants")
require("class")
require("ui/ViewBase")
require("utils/XLuaUtils")

local EventDispatcher = require("event/EventDispatcher")

local Vector3 = CS.UnityEngine.Vector3

local CS_type_ObjList = typeof(CS.ObjList)

local CS_EventControllerInst = CS.EventController.inst
local CS_GameEventType = CS.GameEventType

local CS_UserDataProxyInst = CS.UserDataProxy.inst
local CS_PetDataProxyInst = CS.PetDataProxy.inst
local CS_LanguageManagerInst = CS.LanguageManager.inst
local CS_GameTimerInst = CS.GameTimer.inst

local CS_CharacterManagerInst = CS.CharacterManager.inst
local CS_SpineUtils = CS.SpineUtils

StorePetHouseConfirmUI = class(ViewBase)

function StorePetHouseConfirmUI:ctor()
	self.viewID = Constants.ViewName.StorePetHouseConfirmUI
	StorePetHouseConfirmUI.super.init(self, self.viewID)
	self.sortingLayerName = "window"
	self.isShowResPanel = false
end
------------------------------------------------


function StorePetHouseConfirmUI:initComp()
	local contentPane = self.contentPanel

	self.closeBtn =  contentPane:GetButton("closeBtn");
	self.maskBtn =  contentPane:GetButton("maskBtn");
	self.cancelBtn = contentPane:GetButton("cancelBtn")
	self.confirmBtn = contentPane:GetButton("confirmBtn")
	
	self.uiAnimator = contentPane.uiAnimator

end


function StorePetHouseConfirmUI:onInit()

	self.headGraphicSystem = nil
	self:initComp()

	self.closeBtn:ButtonClickTween(
		function ()
			self:hide()
		end)

	self.maskBtn.onClick:AddListener(
		function ()
			self:hide()
		end)

	self.cancelBtn:ButtonClickTween(
		function ()
			self:hide()
		end)

	self.confirmBtn:ButtonClickTween(
		function ()
			self:confirmBtnClick()
		end)

end


function StorePetHouseConfirmUI:onHide()
	print("StorePetHouseConfirmUI onHide")
end

function StorePetHouseConfirmUI:onShowed()
	print("StorePetHouseConfirmUI onShowed")
end

function StorePetHouseConfirmUI:DoShowAnimation()

	self:onShowed()

	self.uiAnimator:CrossFade("show", 0);
	self.uiAnimator:Update(0);
	self.uiAnimator:Play("show");

end

function StorePetHouseConfirmUI:DoHideAnimation()

	self.uiAnimator:Play("hide");
	local animLength = self.uiAnimator:GetClipLength("common_popUpUI_hide")

	CS_GameTimerInst:AddTimer(animLength,1,function ()
			self.uiAnimator:CrossFade("null", 0);
			self.uiAnimator:Update(0);
			self:HideView();
		end)

end

function StorePetHouseConfirmUI:SetData(furnitureUid)

	self.furnitureUid = furnitureUid

end


function StorePetHouseConfirmUI:shiftIn()
	self.contentObject:SetActive(true)
end

function StorePetHouseConfirmUI:shiftOut()
	self.contentObject:SetActive(false)
end

function StorePetHouseConfirmUI:confirmBtnClick()
	
	self:hide()
	GUIManager.inst:HideView(Constants.ViewName.PetSettingUI)
	GUIManager.inst:HideView(Constants.ViewName.PetDetailUI)
	CS_EventControllerInst:TriggerEvent(CS_GameEventType.ShopDesignEvent.EXITPETHOUSE)
	
	local booleanResult,eneity = CS.IndoorMap.inst:GetFurnituresByUid(self.furnitureUid)
	
	CS.IndoorMap.inst.currSelectEntity = eneity
	CS.IndoorMapEditSys.inst.storePetHouseByPetSetting = true
	
	local mSelectItem = CS_UserDataProxyInst:GetFuriture(self.furnitureUid)
	CS.IndoorMapEditSys.inst:storeItem(mSelectItem.uid, mSelectItem.type);

end

------------------------------------------------