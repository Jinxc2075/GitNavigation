--UnionAidUIView

require("const/Constants")
require("class")
require("ui/ViewBase")
require("utils/XLuaUtils")

local EventDispatcher = require("event/EventDispatcher")

local CS_type_superList = typeof(CS.Mosframe.DynamicScrollView)

local CS_EventControllerInst = CS.EventController.inst
local CS_GameEventType = CS.GameEventType
local CS_GameTimerInst = CS.GameTimer.inst

local CS_UserDataProxyInst = CS.UserDataProxy.inst
local CS_LanguageManagerInst = CS.LanguageManager.inst

UnionAidUIView = class(ViewBase)

function UnionAidUIView:ctor()
	self.viewID = Constants.ViewName.UnionAidUIView
	UnionAidUIView.super.init(self, self.viewID)
	self.sortingLayerName = "window"
	self.isShowResPanel = true
	self.topResPanelType = CS.TopPlayerShowType.selfUnionToken
end
------------------------------------------------

--[[

closeBtn
allAidBtn
superList
nothingTip
allAidBtnTx

--]]

function UnionAidUIView:initComp()
	local contentPane = self.contentPanel

	self.closeBtn =  contentPane:GetButton("closeBtn");
	self.allAidBtn =  contentPane:GetButton("allAidBtn");
	local superList =  contentPane:GetObjByName("ItemList")
	self.superList = superList:GetComponent(CS_type_superList)
	self.nothingTip = contentPane:GetObjByName("nothingTip")
	self.allAidBtnTx = contentPane:GetText("allAidBtnTx")
	
	self.uiAnimator = contentPane.uiAnimator

end


function UnionAidUIView:onInit()

	self:initComp()

	self.superList.itemRenderer = function(index,item)
		self:ListItemRenderer(index,item)
	end
	
	self.superList.itemUpdateInfo = function(index,item)
		self:ListItemRenderer(index,item)
	end


	self.closeBtn:ButtonClickTween(
		function ()
			self:closeBtnClick()
		end
	)

	self.allAidBtn:ButtonClickTween(

		function()
			
			
			local funcGeneric = xlua.get_generic_method(CS.EventController, "TriggerEvent_Lua2")
			local func_2 = funcGeneric(CS.System.String,CS.UnityEngine.Color)
			
			func_2(CS_EventControllerInst,CS_GameEventType.SHOWUI_TEXTMSGTIP,CS_LanguageManagerInst:GetValueByKey("已全部给予帮助！"), CS.GUIHelper.GetColorByColorHex("FFFFFF"))
			
			EventDispatcher:dispatchEvent(GameEvent.UnionEvent.Request_UnionHelpMember,0,"",0,1)
		end

	)

end


function UnionAidUIView:onHide()
	print("UnionAidUIView onHide")
end

function  UnionAidUIView:onShowed()
	print("UnionAidUIView onShowed")
	
	self:SetData()
	
end

function UnionAidUIView:DoShowAnimation()

	self:onShowed()

	self.uiAnimator:CrossFade("show", 0);
	self.uiAnimator:Update(0);
	self.uiAnimator:Play("show");

end

function UnionAidUIView:DoHideAnimation()

	self.uiAnimator:Play("hide");
	local animLength = self.uiAnimator:GetClipLength("common_popUpUI_hide")

	CS_GameTimerInst:AddTimer(animLength,1,function ()
			self.uiAnimator:CrossFade("null", 0);
			self.uiAnimator:Update(0);
			self:HideView();
		end)

end

function UnionAidUIView:SetData()
	
	self.superList.totalItemCount = CS_UserDataProxyInst.union_aidShowList.Count

	self.nothingTip:SetActive(self.superList.totalItemCount == 0)

	self.allAidBtn.enabled = CS_UserDataProxyInst.union_canAidList.Count > 0
	CS.GUIHelper.SetUIGray(self.allAidBtn.transform,CS_UserDataProxyInst.union_canAidList.Count == 0)

	self.allAidBtnTx.text = CS_LanguageManagerInst:GetValueByKey("全部帮助({0})",tostring(CS_UserDataProxyInst.union_canAidList.Count))

end

function UnionAidUIView:shiftIn()
	self.contentObject:SetActive(true)
end

function UnionAidUIView:shiftOut()
	self.contentObject:SetActive(false)
end

function UnionAidUIView:closeBtnClick()
	self:hide()
end

function UnionAidUIView:ListItemRenderer(index, item)
	item:SetData(index);
end

------------------------------------------------