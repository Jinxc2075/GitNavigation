--LuxuryRankUIView

require("const/Constants")
require("class")
require("ui/ViewBase")
require("config/LuxuryConfigManager")
local csEventControllerInst = CS.EventController.inst
local csGameEventType = CS.GameEventType
local EventDispatcher = require("event/EventDispatcher")
local csUserDataProxyInst = CS.UserDataProxy.inst
local csGUIHelper = CS.GUIHelper
local cs_LanguageManagerInst = CS.LanguageManager.inst
local CS_type_luaList = typeof(CS.LuaListItem)
local CS_type_superList = typeof(CS.Mosframe.DynamicScrollView)
local csGameTimerInst = CS.GameTimer.inst

local data
local dataList = {}

LuxuryRankUIView = class(ViewBase)

function LuxuryRankUIView:ctor()
	self.viewID = Constants.ViewName.LuxuryRankUIView
	LuxuryRankUIView.super.init(self, self.viewID)
	self.sortingLayerName = "window"
end

function LuxuryRankUIView:initComp()
	local contentPane = self.contentPanel

	self.closeBtn = contentPane:GetButton("closeBtn")
	self.bgBtn = contentPane:GetButton("bg")
	local superList =  contentPane:GetObjByName("allInfos")
	self.scrollView = superList:GetComponent(CS_type_superList)
	self.listItemCount = 0

	self.curIcon = contentPane:GetGUIIcon("icon")
	self.nameText = contentPane:GetText("nameText")
	self.curStars = {}
	self.curStars[1] = contentPane:GetGUIIcon("star1")
	self.curStars[2] = contentPane:GetGUIIcon("star2")
	self.curStars[3] = contentPane:GetGUIIcon("star3")
	self.curStars[4] = contentPane:GetGUIIcon("star4")
	self.curStars[5] = contentPane:GetGUIIcon("star5")
	self.selfRankNumText = contentPane:GetText("selfRankNumText")
	self.selfRankNum = contentPane:GetText("selfRankNum")
	self.selfRankIcon = contentPane:GetGUIIcon("selfRankIcon")
	
	self.uiAnimator = contentPane.uiAnimator
end

function LuxuryRankUIView:onInit()

	self:initComp()

	self.closeBtn:ButtonClickTween(
		function ()
			self:closeBtnClick()
		end
	)

	self.bgBtn.onClick:AddListener(
		function ()
			self:closeBtnClick()
		end
	)

	self.scrollView.itemRenderer = function(index,item)
		self:ListItemRenderer(index,item)
	end
end

function LuxuryRankUIView:DoShowAnimation()
	self:onShowed()

	self.uiAnimator:CrossFade("show", 0)
	self.uiAnimator:Update(0)
	self.uiAnimator:Play("show")
end

function LuxuryRankUIView:DoHideAnimation()
	self.uiAnimator:Play("hide")
	local animLength = self.uiAnimator:GetClipLength("common_popUpUI_hide")

	csGameTimerInst:AddTimer(
		animLength,
		1,
		function()
			self.uiAnimator:CrossFade("null", 0)
			self.uiAnimator:Update(0)
			self:HideView()
		end
	)
end

function LuxuryRankUIView:onHide()
	--print("LuxuryRankUIView onHide")
end

function  LuxuryRankUIView:onShowed()
	--print("LuxuryRankUIView onShowed")
end

function LuxuryRankUIView:shiftIn()
	self.contentObject:SetActive(true)
end

function LuxuryRankUIView:shiftOut()
	self.contentObject:SetActive(false)
end

function LuxuryRankUIView:closeBtnClick()
	self:hide()
end

function LuxuryRankUIView:SetUIData(_data)
	data = _data
	dataList = data.rankList
	local itemCount = #dataList

	local selfData = LuxuryConfigManager:GetConfigByLuxuryNum(data.userRank.prosperity)
	if(selfData == nil)then
		selfData = LuxuryConfigData:new()
		local tempSelfData = LuxuryConfigManager:GetConfig(1)
		selfData.atlas = tempSelfData.atlas
		selfData.icon = tempSelfData.icon
		selfData.stars = 0
	end
	self.curIcon:SetSprite(selfData.atlas,selfData.icon)
	for i = 1, #self.curStars do
		if(i <= tonumber(selfData.stars))then
			self.curStars[i]:SetSprite("luxury_atlas","yingxiong_xingcheng")
		else
			self.curStars[i]:SetSprite("luxury_atlas","yingxiong_xingcheng1")
		end
	end
	self.selfRankNumText.text = tostring(data.userRank.prosperity)
	self.selfRankNum.text = tostring(data.userRank.rank)

	if(tonumber(data.userRank.rank) == 1)then
		self.selfRankIcon.iconImage.enabled = true
		self.selfRankIcon:SetSprite("luxury_atlas","jiaju_paiming1")
	elseif tonumber(data.userRank.rank) == 2 then
		self.selfRankIcon.iconImage.enabled = true
		self.selfRankIcon:SetSprite("luxury_atlas","jiaju_paiming2")
	elseif tonumber(data.userRank.rank) == 3 then
		self.selfRankIcon.iconImage.enabled = true
		self.selfRankIcon:SetSprite("luxury_atlas","jiaju_paiming3")
	else
		self.selfRankIcon.iconImage.enabled = false
	end
	self:SetListItemTotalCount(itemCount)
end

function LuxuryRankUIView:ListItemRenderer(index,item)
	local prefabItem = item
	if(index >= self.listItemCount)then
		prefabItem.gameObject:SetActive(false)
	end

	if(index < self.listItemCount)then
		prefabItem.gameObject:SetActive(true)
		prefabItem:SetData(dataList[index + 1])
	end
end

function LuxuryRankUIView:SetListItemTotalCount(count)
	self.listItemCount = count
	if(count < 0)then
		self.listItemCount = 0
	end

	self.scrollView.totalItemCount = count
end
------------------------------------------------